cscope 15 $HOME/ring_tumbes/ring-basic-p-master/src               0000020491
	@build-index-uring.cpp

21 
	~<io¡»am
>

22 
	~"uršg.hµ
"

23 
	~"uršg_muthu.hµ
"

24 
	~<f¡»am
>

25 
	~<sd¦/cÚ¡ruù.hµ
>

26 
	~<Éj_®gÜ™hm.hµ
>

28 
usšg
 
Çme¥aû
 
	g¡d
;

30 
usšg
 
Çme¥aû
 
	g¡d
::
chrÚo
;

31 
usšg
 
	gtim”
 = 
¡d
::
chrÚo
::
high_»sŞutiÚ_şock
;

33 
	g‹m¶©e
<
şass
 
	gršg
>

34 
	$bud_šdex
(cÚ¡ 
¡d
::
¡ršg
 &
d©a£t
, cÚ¡ std::¡ršg &
ouut
){

35 
veùÜ
<
¥o_ŒË
> 
D
, 
E
;

37 
¡d
::
if¡»am
 
	`ifs
(
d©a£t
);

38 
ušt64_t
 
s
, 
p
 , 
o
;

40 
ifs
 >> 
s
 >> 
p
 >> 
o
;

41 
D
.
	`push_back
(
	`¥o_ŒË
(
s
, 
p
, 
o
));

42 } !
ifs
.
	`eof
());

44 
D
.
	`shršk_to_f™
();

45 
cout
 << "--Indexšg " << 
D
.
	`size
(è<< "rËs" << 
’dl
;

46 
memÜy_mÚ™Ü
::
	`¡¬t
();

47 autØ
¡¬t
 = 
tim”
::
	`now
();

49 
ršg
 
	`A
(
D
);

50 autØ
¡İ
 = 
tim”
::
	`now
();

51 
memÜy_mÚ™Ü
::
	`¡İ
();

52 
cout
 << " Index buˆ " << 
sd¦
::
	`size_š_by‹s
(
A
è<< " by‹s" << 
’dl
;

54 
sd¦
::
	`¡Üe_to_fe
(
A
, 
ouut
);

55 
cout
 << "Index saved" << 
’dl
;

56 
cout
 << 
du¿tiÚ_ÿ¡
<
£cÚds
>(
¡İ
-
¡¬t
).
	`couÁ
(è<< " secÚds." << 
’dl
;

57 
cout
 << 
memÜy_mÚ™Ü
::
	`³ak
(è<< " by‹s." << 
’dl
;

59 
	}
}

61 
	$maš
(
¬gc
, **
¬gv
)

64 if(
¬gc
 != 3){

65 
¡d
::
cout
 << "U§ge: " << 
¬gv
[0] << " <d©a£t> [uršg|c-uršg|uršg-muthu|c-ršg-muthu]" << std::
’dl
;

69 
¡d
::
¡ršg
 
d©a£t
 = 
¬gv
[1];

70 
¡d
::
¡ršg
 
ty³
 = 
¬gv
[2];

71 if(
ty³
 == "uring"){

72 
¡d
::
¡ršg
 
šdex_Çme
 = 
d©a£t
 + ".uring";

73 
bud_šdex
<
ršg
::
uršg
<>>(
d©a£t
, 
šdex_Çme
);

74 }ià(
ty³
 == "c-uring"){

75 
¡d
::
¡ršg
 
šdex_Çme
 = 
d©a£t
 + ".c-uring";

76 
bud_šdex
<
ršg
::
c_uršg
>(
d©a£t
, 
šdex_Çme
);

77 }if(
ty³
 == "uring-muthu"){

78 
¡d
::
¡ršg
 
šdex_Çme
 = 
d©a£t
 + ".uring-muthu";

79 
bud_šdex
<
ršg
::
uršg_muthu
<>>(
d©a£t
, 
šdex_Çme
);

80 }ià(
ty³
 == "c-uring-muthu"){

81 
¡d
::
¡ršg
 
šdex_Çme
 = 
d©a£t
 + ".c-uring-muthu";

82 
bud_šdex
<
ršg
::
c_uršg_muthu
>(
d©a£t
, 
šdex_Çme
);

84 
¡d
::
cout
 << "U§ge: " << 
¬gv
[0] << " <d©a£t> [uršg|c-uršg|uršg-muthu|c-ršg-muthu]" << std::
’dl
;

88 
	}
}

	@build-index.cpp

21 
	~<io¡»am
>

22 
	~"ršg.hµ
"

24 
	~<f¡»am
>

25 
	~<sd¦/cÚ¡ruù.hµ
>

26 
	~<Éj_®gÜ™hm.hµ
>

28 
usšg
 
Çme¥aû
 
	g¡d
;

30 
usšg
 
Çme¥aû
 
	g¡d
::
chrÚo
;

31 
usšg
 
	gtim”
 = 
¡d
::
chrÚo
::
high_»sŞutiÚ_şock
;

33 
	g‹m¶©e
<
şass
 
	gršg
>

34 
	$bud_šdex
(cÚ¡ 
¡d
::
¡ršg
 &
d©a£t
, cÚ¡ std::¡ršg &
ouut
){

35 
veùÜ
<
¥o_ŒË
> 
D
, 
E
;

37 
¡d
::
if¡»am
 
	`ifs
(
d©a£t
);

38 
ušt64_t
 
s
, 
p
 , 
o
;

40 
ifs
 >> 
s
 >> 
p
 >> 
o
;

41 
D
.
	`push_back
(
	`¥o_ŒË
(
s
, 
p
, 
o
));

42 } !
ifs
.
	`eof
());

44 
D
.
	`shršk_to_f™
();

45 
cout
 << "--Indexšg " << 
D
.
	`size
(è<< "rËs" << 
’dl
;

46 
memÜy_mÚ™Ü
::
	`¡¬t
();

47 autØ
¡¬t
 = 
tim”
::
	`now
();

49 
ršg
 
	`A
(
D
);

50 autØ
¡İ
 = 
tim”
::
	`now
();

51 
memÜy_mÚ™Ü
::
	`¡İ
();

52 
cout
 << " Index buˆ " << 
sd¦
::
	`size_š_by‹s
(
A
è<< " by‹s" << 
’dl
;

54 
sd¦
::
	`¡Üe_to_fe
(
A
, 
ouut
);

55 
cout
 << "Index saved" << 
’dl
;

56 
cout
 << 
du¿tiÚ_ÿ¡
<
£cÚds
>(
¡İ
-
¡¬t
).
	`couÁ
(è<< " secÚds." << 
’dl
;

57 
cout
 << 
memÜy_mÚ™Ü
::
	`³ak
(è<< " by‹s." << 
’dl
;

59 
	}
}

61 
	$maš
(
¬gc
, **
¬gv
)

64 if(
¬gc
 != 3){

65 
¡d
::
cout
 << "U§ge: " << 
¬gv
[0] << " <d©a£t> [ršg|c-ršg|ršg-£l|ršg-muthu|c-ršg-muthu|ršg-£l-muthu]" << std::
’dl
;

69 
¡d
::
¡ršg
 
d©a£t
 = 
¬gv
[1];

70 
¡d
::
¡ršg
 
ty³
 = 
¬gv
[2];

71 if(
ty³
 == "ring"){

72 
¡d
::
¡ršg
 
šdex_Çme
 = 
d©a£t
 + ".ring";

73 
bud_šdex
<
ršg
::ršg<>>(
d©a£t
, 
šdex_Çme
);

74 }ià(
ty³
 == "c-ring"){

75 
¡d
::
¡ršg
 
šdex_Çme
 = 
d©a£t
 + ".c-ring";

76 
bud_šdex
<
ršg
::
c_ršg
>(
d©a£t
, 
šdex_Çme
);

77 }ià(
ty³
 == "ring-sel"){

78 
¡d
::
¡ršg
 
šdex_Çme
 = 
d©a£t
 + ".ring-sel";

79 
bud_šdex
<
ršg
::
ršg_£l
>(
d©a£t
, 
šdex_Çme
);

80 }ià(
ty³
 == "ring-muthu"){

81 
¡d
::
¡ršg
 
šdex_Çme
 = 
d©a£t
 + ".ring-muthu";

83 }ià(
ty³
 == "c-ring-muthu"){

84 
¡d
::
¡ršg
 
šdex_Çme
 = 
d©a£t
 + ".c-ring-muthu";

86 }ià(
ty³
 == "ring-sel-muthu"){

87 
¡d
::
¡ršg
 
šdex_Çme
 = 
d©a£t
 + ".ring-sel-muthu";

90 
¡d
::
cout
 << "U§ge: " << 
¬gv
[0] << " <d©a£t> [ršg|c-ršg|ršg-£l|ršg-muthu|c-ršg-muthu|ršg-£l-muthu]" << std::
’dl
;

94 
	}
}

	@check.cpp

20 
	~<io¡»am
>

21 
	~<ut™y
>

22 
	~"ršg.hµ
"

23 
	~<chrÚo
>

24 
	~<ŒË_·‰”n.hµ
>

25 
	~<Éj_®gÜ™hm.hµ
>

26 
	~<Éj_™”©Ü.hµ
>

27 
	~"uts.hµ
"

28 
	~<ršg_muthu.hµ
>

29 
	~<time.hµ
>

31 
usšg
 
Çme¥aû
 
	g¡d
;

36 
usšg
 
	gÇme¥aû
 ::
ut
::
time
;

38 
boŞ
 
g‘_fe_cÚ‹Á
(
¡ršg
 
f’ame
, 
veùÜ
<¡ršg> & 
veùÜ_of_¡ršgs
)

41 
if¡»am
 
š
(
f’ame
.
c_¡r
());

43 if(!
	gš
)

45 
	gû¼
 << "CªnÙ o³ÀthF: " << 
	gf’ame
 << 
	g’dl
;

46  
	gçl£
;

48 
¡ršg
 
	g¡r
;

50 
g‘lše
(
š
, 
¡r
))

53 if(
	g¡r
.
size
() > 0)

54 
	gveùÜ_of_¡ršgs
.
push_back
(
¡r
);

57 
	gš
.
şo£
();

58  
	gŒue
;

61 
	g¡d
::
¡ršg
 
	$Érim
(cÚ¡ 
¡d
::
¡ršg
 &
s
)

63 
size_t
 
¡¬t
 = 
s
.
	`fšd_fœ¡_nÙ_of
(' ');

64  (
¡¬t
 =ğ
¡d
::
¡ršg
::
Åos
è? "" : 
s
.
	`sub¡r
(start);

65 
	}
}

67 
	g¡d
::
¡ršg
 
	$¹rim
(cÚ¡ 
¡d
::
¡ršg
 &
s
)

69 
size_t
 
’d
 = 
s
.
	`fšd_Ï¡_nÙ_of
(' ');

70  (
’d
 =ğ
¡d
::
¡ršg
::
Åos
è? "" : 
s
.
	`sub¡r
(0,ƒnd + 1);

71 
	}
}

73 
	g¡d
::
¡ršg
 
	$Œim
(cÚ¡ 
¡d
::
¡ršg
 &
s
) {

74  
	`¹rim
(
	`Érim
(
s
));

75 
	}
}

77 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
	$tok’iz”
(cÚ¡ 
¡d
::
¡ršg
 &
šput
, cÚ¡ &
d–im™”
){

78 
¡d
::
¡ršg¡»am
 
	`¡»am
(
šput
);

79 
¡d
::
¡ršg
 
tok’
;

80 
¡d
::
veùÜ
<¡d::
¡ršg
> 
»s
;

81 
	`g‘lše
(
¡»am
, 
tok’
, 
d–im™”
)){

82 
»s
.
	`em¶aû_back
(
	`Œim
(
tok’
));

84  
»s
;

85 
	}
}

87 
boŞ
 
	$is_v¬ŸbË
(
¡ršg
 & 
s
)

89  (
s
.
	`©
(0) == '?');

90 
	}
}

92 
ušt8_t
 
g‘_v¬ŸbË
(
¡ršg
 &
s
, 
¡d
::
unÜd”ed_m­
<¡d::¡ršg, ušt8_t> &
hash_bË_v¬s
){

93 autØ
	gv¬
 = 
s
.
sub¡r
(1);

94 autØ
	g™
 = 
hash_bË_v¬s
.
fšd
(
v¬
);

95 if(
	g™
 =ğ
hash_bË_v¬s
.
’d
()){

96 
ušt8_t
 
id
 = 
hash_bË_v¬s
.
size
();

97 
	ghash_bË_v¬s
.
š£¹
({
v¬
, 
id
 });

98  
	gid
;

100  
	g™
->
	g£cÚd
;

104 
ušt64_t
 
	$g‘_cÚ¡ªt
(
¡ršg
 &
s
){

105  
¡d
::
	`¡ouÎ
(
s
);

106 
	}
}

108 
	gršg
::
ŒË_·‰”n
 
g‘_ŒË
(
¡ršg
 & 
s
, 
¡d
::
unÜd”ed_m­
<¡d::¡ršg, 
ušt8_t
> &
hash_bË_v¬s
) {

109 
	gveùÜ
<
	g¡ršg
> 
	g‹rms
 = 
tok’iz”
(
s
, ' ');

111 
	gršg
::
ŒË_·‰”n
 
ŒË
;

112 if(
is_v¬ŸbË
(
‹rms
[0])){

113 
	gŒË
.
v¬_s
(
g‘_v¬ŸbË
(
‹rms
[0], 
hash_bË_v¬s
));

115 
	gŒË
.
cÚ¡_s
(
g‘_cÚ¡ªt
(
‹rms
[0]));

117 if(
is_v¬ŸbË
(
‹rms
[1])){

118 
	gŒË
.
v¬_p
(
g‘_v¬ŸbË
(
‹rms
[1], 
hash_bË_v¬s
));

120 
	gŒË
.
cÚ¡_p
(
g‘_cÚ¡ªt
(
‹rms
[1]));

122 if(
is_v¬ŸbË
(
‹rms
[2])){

123 
	gŒË
.
v¬_o
(
g‘_v¬ŸbË
(
‹rms
[2], 
hash_bË_v¬s
));

125 
	gŒË
.
cÚ¡_o
(
g‘_cÚ¡ªt
(
‹rms
[2]));

127  
	gŒË
;

130 
	g¡d
::
¡ršg
 
	$g‘_ty³
(cÚ¡ 
¡d
::
¡ršg
 &
fe
){

131 autØ
p
 = 
fe
.
	`fšd_Ï¡_of
('.');

132  
fe
.
	`sub¡r
(
p
+1);

133 
	}
}

136 
	$qu”y
(cÚ¡ 
¡d
::
¡ršg
 &
qu”›s
){

137 
veùÜ
<
¡ršg
> 
dummy_qu”›s
;

138 
boŞ
 
»suÉ
 = 
	`g‘_fe_cÚ‹Á
(
qu”›s
, 
dummy_qu”›s
);

140 
¡d
::
if¡»am
 
ifs
;

141 
ušt64_t
 
nQ
 = 0;

142 
ušt64_t
 
§me
 = 0, 
diff
 = 0;

144 if(
»suÉ
)

147 
couÁ
 = 1;

148 
¡ršg
& 
qu”y_¡ršg
 : 
dummy_qu”›s
) {

152 
¡d
::
unÜd”ed_m­
<¡d::
¡ršg
, 
ušt8_t
> 
hash_bË_v¬s
;

153 
¡d
::
veùÜ
<
ršg
::
ŒË_·‰”n
> 
qu”y
;

154 
veùÜ
<
¡ršg
> 
tok’s_qu”y
 = 
	`tok’iz”
(
qu”y_¡ršg
, '.');

155 
¡ršg
& 
tok’
 : 
tok’s_qu”y
) {

156 autØ
ŒË_·‰”n
 = 
	`g‘_ŒË
(
tok’
, 
hash_bË_v¬s
);

157 
qu”y
.
	`push_back
(
ŒË_·‰”n
);

160 
¡d
::
unÜd”ed_m­
<
ušt8_t
, 
ušt64_t
> 
ht
;

161 cÚ¡‡utØ& 

 : 
qu”y
){

162 
ušt64_t
 
s_aux
 = -1, 
p_aux
 = -1, 
o_aux
 = -1;

163 if(

.
	`s_is_v¬ŸbË
()){

164 
s_aux
 = 

.
‹rm_s
.
v®ue
;

165 autØ
™
 = 
ht
.
	`fšd
(
s_aux
);

166 if(
™
 =ğ
ht
.
	`’d
()){

167 
ht
.
	`š£¹
({
s_aux
, 1});

169 ++
™
->
£cÚd
;

172 if(

.
	`p_is_v¬ŸbË
()){

173 
p_aux
 = 

.
‹rm_p
.
v®ue
;

174 autØ
™
 = 
ht
.
	`fšd
(
p_aux
);

175 if(
™
 =ğ
ht
.
	`’d
()){

176 
ht
.
	`š£¹
({
p_aux
, 1});

178 ++
™
->
£cÚd
;

182 if(

.
	`o_is_v¬ŸbË
()){

183 
o_aux
 = 

.
‹rm_o
.
v®ue
;

184 if(
o_aux
 !ğ
s_aux
){

185 autØ
™
 = 
ht
.
	`fšd
(
o_aux
);

186 if(
™
 =ğ
ht
.
	`’d
()){

187 
ht
.
	`š£¹
({
o_aux
, 1});

189 ++
™
->
£cÚd
;

196 
ušt64_t
 
num_lÚ–y
 = 0, 
num_no_lÚ–y
 = 0;

197 cÚ¡‡utØ&
v
 : 
ht
){

198 if(
v
.
£cÚd
 > 1){

199 ++
num_no_lÚ–y
;

201 ++
num_lÚ–y
;

206 if(
num_no_lÚ–y
 <= 1){

207 ++
§me
;

208 if(
num_no_lÚ–y
 == 1){

209 
cout
 << 
nQ
 << ";" << "TYPE2" << 
’dl
;

211 
cout
 << 
nQ
 << ";" << "TYPE1" << 
’dl
;

215 ++
diff
;

216 
cout
 << 
nQ
 << ";" << "TYPE3" << 
’dl
;

219 
nQ
++;

224 
couÁ
 += 1;

237 
¡d
::
û¼
 << "TÙ®: " << 
nQ
 << " same=" << 
§me
 << " diff=" << 
diff
 << 
’dl
;

240 
	}
}

243 
	$maš
(
¬gc
, * 
¬gv
[])

246 
ršg
::
	tršg
<> 
	tršg_ty³
;

248 if(
¬gc
 != 2){

249 
¡d
::
cout
 << "U§ge: " << 
¬gv
[0] << " <qu”›s>" << std::
’dl
;

252 
¡d
::
¡ršg
 
qu”›s
 = 
¬gv
[1];

253 
	`qu”y
(
qu”›s
);

256 
	}
}

	@proba.cpp

4 
	~<sd¦/wav–‘_Œ“s.hµ
>

5 
	~<wt_¿nge_™”©Ü.hµ
>

7 
	$maš
(
¬gc
, * 
¬gv
[]) {

9 
sd¦
::
wm_št
<> 
wm
;

10 
sd¦
::
št_veùÜ
<> 
vec
 = {2, 3, 6 , 8, 2, 1, 2, 3, 4,5 ,6, 3 ,4, 3,5, 8};

11 
sd¦
::
	`cÚ¡ruù_im
(
wm
 , 
vec
);

13 
sd¦
::
wt_¿nge_™”©Ü
<sd¦::
wm_št
<>> 
	`™”©Ü
(&
wm
, sd¦::
¿nge_ty³
{3, 9});

15 autØ
v
 = 
™”©Ü
.
	`Ãxt
();

16 
v
 != 0){

17 
¡d
::
cout
 << 
v
 << std::
’dl
;

18 
v
 = 
™”©Ü
.
	`Ãxt
();

20 
	}
}

	@query-index-uring.cpp

20 
	~<io¡»am
>

21 
	~<ut™y
>

22 
	~"uršg.hµ
"

23 
	~"uršg_muthu.hµ
"

24 
	~<chrÚo
>

25 
	~<ŒË_·‰”n.hµ
>

26 
	~<Éj_®gÜ™hm_unidœeùiÚ®.hµ
>

27 
	~"uts.hµ
"

28 
	~<time.hµ
>

30 
usšg
 
Çme¥aû
 
	g¡d
;

35 
usšg
 
	gÇme¥aû
 ::
ut
::
time
;

37 
boŞ
 
g‘_fe_cÚ‹Á
(
¡ršg
 
f’ame
, 
veùÜ
<¡ršg> & 
veùÜ_of_¡ršgs
)

40 
if¡»am
 
š
(
f’ame
.
c_¡r
());

42 if(!
	gš
)

44 
	gû¼
 << "CªnÙ o³ÀthF: " << 
	gf’ame
 << 
	g’dl
;

45  
	gçl£
;

47 
¡ršg
 
	g¡r
;

49 
g‘lše
(
š
, 
¡r
))

52 if(
	g¡r
.
size
() > 0)

53 
	gveùÜ_of_¡ršgs
.
push_back
(
¡r
);

56 
	gš
.
şo£
();

57  
	gŒue
;

60 
	g¡d
::
¡ršg
 
	$Érim
(cÚ¡ 
¡d
::
¡ršg
 &
s
)

62 
size_t
 
¡¬t
 = 
s
.
	`fšd_fœ¡_nÙ_of
(' ');

63  (
¡¬t
 =ğ
¡d
::
¡ršg
::
Åos
è? "" : 
s
.
	`sub¡r
(start);

64 
	}
}

66 
	g¡d
::
¡ršg
 
	$¹rim
(cÚ¡ 
¡d
::
¡ršg
 &
s
)

68 
size_t
 
’d
 = 
s
.
	`fšd_Ï¡_nÙ_of
(' ');

69  (
’d
 =ğ
¡d
::
¡ršg
::
Åos
è? "" : 
s
.
	`sub¡r
(0,ƒnd + 1);

70 
	}
}

72 
	g¡d
::
¡ršg
 
	$Œim
(cÚ¡ 
¡d
::
¡ršg
 &
s
) {

73  
	`¹rim
(
	`Érim
(
s
));

74 
	}
}

76 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
	$tok’iz”
(cÚ¡ 
¡d
::
¡ršg
 &
šput
, cÚ¡ &
d–im™”
){

77 
¡d
::
¡ršg¡»am
 
	`¡»am
(
šput
);

78 
¡d
::
¡ršg
 
tok’
;

79 
¡d
::
veùÜ
<¡d::
¡ršg
> 
»s
;

80 
	`g‘lše
(
¡»am
, 
tok’
, 
d–im™”
)){

81 
»s
.
	`em¶aû_back
(
	`Œim
(
tok’
));

83  
»s
;

84 
	}
}

86 
boŞ
 
	$is_v¬ŸbË
(
¡ršg
 & 
s
)

88  (
s
.
	`©
(0) == '?');

89 
	}
}

91 
ušt8_t
 
g‘_v¬ŸbË
(
¡ršg
 &
s
, 
¡d
::
unÜd”ed_m­
<¡d::¡ršg, ušt8_t> &
hash_bË_v¬s
){

92 autØ
	gv¬
 = 
s
.
sub¡r
(1);

93 autØ
	g™
 = 
hash_bË_v¬s
.
fšd
(
v¬
);

94 if(
	g™
 =ğ
hash_bË_v¬s
.
’d
()){

95 
ušt8_t
 
id
 = 
hash_bË_v¬s
.
size
();

96 
	ghash_bË_v¬s
.
š£¹
({
v¬
, 
id
 });

97  
	gid
;

99  
	g™
->
	g£cÚd
;

103 
ušt64_t
 
	$g‘_cÚ¡ªt
(
¡ršg
 &
s
){

104  
¡d
::
	`¡ouÎ
(
s
);

105 
	}
}

107 
	gršg
::
ŒË_·‰”n
 
g‘_ŒË
(
¡ršg
 & 
s
, 
¡d
::
unÜd”ed_m­
<¡d::¡ršg, 
ušt8_t
> &
hash_bË_v¬s
) {

108 
	gveùÜ
<
	g¡ršg
> 
	g‹rms
 = 
tok’iz”
(
s
, ' ');

110 
	gršg
::
ŒË_·‰”n
 
ŒË
;

111 if(
is_v¬ŸbË
(
‹rms
[0])){

112 
	gŒË
.
v¬_s
(
g‘_v¬ŸbË
(
‹rms
[0], 
hash_bË_v¬s
));

114 
	gŒË
.
cÚ¡_s
(
g‘_cÚ¡ªt
(
‹rms
[0]));

116 if(
is_v¬ŸbË
(
‹rms
[1])){

117 
	gŒË
.
v¬_p
(
g‘_v¬ŸbË
(
‹rms
[1], 
hash_bË_v¬s
));

119 
	gŒË
.
cÚ¡_p
(
g‘_cÚ¡ªt
(
‹rms
[1]));

121 if(
is_v¬ŸbË
(
‹rms
[2])){

122 
	gŒË
.
v¬_o
(
g‘_v¬ŸbË
(
‹rms
[2], 
hash_bË_v¬s
));

124 
	gŒË
.
cÚ¡_o
(
g‘_cÚ¡ªt
(
‹rms
[2]));

126  
	gŒË
;

129 
	g¡d
::
¡ršg
 
	$g‘_ty³
(cÚ¡ 
¡d
::
¡ršg
 &
fe
){

130 autØ
p
 = 
fe
.
	`fšd_Ï¡_of
('.');

131  
fe
.
	`sub¡r
(
p
+1);

132 
	}
}

135 
	g‹m¶©e
<
şass
 
	gršg_ty³
, cÏs 
	gŒa™_ty³
>

136 
	$qu”y
(cÚ¡ 
¡d
::
¡ršg
 &
fe
, cÚ¡ std::¡ršg &
qu”›s
, 
ušt64_t
 
lim™
){

137 
veùÜ
<
¡ršg
> 
dummy_qu”›s
;

138 
boŞ
 
»suÉ
 = 
	`g‘_fe_cÚ‹Á
(
qu”›s
, 
dummy_qu”›s
);

140 
ršg_ty³
 
g¿ph
;

142 
cout
 << " Lßdšghšdex..."; 
	`fæush
(
¡dout
);

143 
sd¦
::
	`lßd_äom_fe
(
g¿ph
, 
fe
);

145 
cout
 << 
’dl
 << " Index†ßded " << 
sd¦
::
	`size_š_by‹s
(
g¿ph
) << " bytes" <<ƒndl;

147 
¡d
::
if¡»am
 
ifs
;

148 
ušt64_t
 
nQ
 = 0;

150 ::
ut
::
time
::
u§ge
::
u§ge_ty³
 
¡¬t
, 
¡İ
;

151 
ušt64_t
 
tÙ®_–­£d_time
;

152 
ušt64_t
 
tÙ®_u£r_time
;

153 if(
»suÉ
)

156 
couÁ
 = 1;

157 
¡ršg
& 
qu”y_¡ršg
 : 
dummy_qu”›s
) {

161 
¡d
::
unÜd”ed_m­
<¡d::
¡ršg
, 
ušt8_t
> 
hash_bË_v¬s
;

162 
¡d
::
veùÜ
<
ršg
::
ŒË_·‰”n
> 
qu”y
;

163 
veùÜ
<
¡ršg
> 
tok’s_qu”y
 = 
	`tok’iz”
(
qu”y_¡ršg
, '.');

164 
¡ršg
& 
tok’
 : 
tok’s_qu”y
) {

165 autØ
ŒË_·‰”n
 = 
	`g‘_ŒË
(
tok’
, 
hash_bË_v¬s
);

166 
qu”y
.
	`push_back
(
ŒË_·‰”n
);

169 
ršg
::
	tÉj_™”©Ü_unidœeùiÚ®
<
	tršg_ty³
, 
	tušt8_t
, 
	tušt64_t
> 
	t™”©Ü_ty³
;

170 #ià
ADAPTIVE


171 
ršg
::
	tÉj_®gÜ™hm_unidœeùiÚ®
<
	t™”©Ü_ty³
,

172 
	tršg
::
	tveo
::
	tveo_ad­tive
<
	t™”©Ü_ty³
, 
	tŒa™_ty³
>> 
	t®gÜ™hm_ty³
;

174 
ršg
::
	tÉj_®gÜ™hm_unidœeùiÚ®
<
	t™”©Ü_ty³
,

175 
	tršg
::
	tveo
::
	tveo_sim¶e
<
	t™”©Ü_ty³
, 
	tŒa™_ty³
>> 
	t®gÜ™hm_ty³
;

177 
¡d
::
	tveùÜ
<
	tty³Çme
 
	t®gÜ™hm_ty³
::
	ttu¶e_ty³
> 
	t»suÉs_ty³
;

178 
»suÉs_ty³
 
»s
;

180 
¡¬t
 = ::
ut
::
time
::
u§ge
::
	`now
();

181 
®gÜ™hm_ty³
 
	`Éj
(&
qu”y
, &
g¿ph
);

182 
Éj
.
	`još
(
»s
, 
lim™
, 600);

183 
¡İ
 = ::
ut
::
time
::
u§ge
::
	`now
();

185 
tÙ®_–­£d_time
 = (
ušt64_t
è
du¿tiÚ_ÿ¡
<
Çno£cÚds
>(
¡İ
.
–­£d
 - 
¡¬t
.elapsed);

186 
tÙ®_u£r_time
 = (
ušt64_t
è
du¿tiÚ_ÿ¡
<
Çno£cÚds
>(
¡İ
.
u£r
 - 
¡¬t
.user);

200 
cout
 << 
nQ
 << ";" << 
»s
.
	`size
(è<< ";" << 
tÙ®_–­£d_time
 << ";" << 
tÙ®_u£r_time
 << 
’dl
;

201 
nQ
++;

206 
couÁ
 += 1;

210 
	}
}

213 
	$maš
(
¬gc
, * 
¬gv
[])

216 
ršg
::
	tršg
<> 
	tršg_ty³
;

218 if(
¬gc
 != 4){

219 
¡d
::
cout
 << "U§ge: " << 
¬gv
[0] << " <šdex> <qu”›s> <lim™>" << std::
’dl
;

223 
¡d
::
¡ršg
 
šdex
 = 
¬gv
[1];

224 
¡d
::
¡ršg
 
qu”›s
 = 
¬gv
[2];

225 
ušt64_t
 
lim™
 = 
¡d
::
	`©Şl
(
¬gv
[3]);

226 
¡d
::
¡ršg
 
ty³
 = 
	`g‘_ty³
(
šdex
);

228 if(
ty³
 == "uring"){

229 
qu”y
<
ršg
::
uršg
<>,„šg::
ut
::
Œa™_size
>(
šdex
, 
qu”›s
, 
lim™
);

230 }ià(
ty³
 == "c-uring"){

231 
qu”y
<
ršg
::
c_uršg
,„šg::
ut
::
Œa™_size
>(
šdex
, 
qu”›s
, 
lim™
);

232 }if(
ty³
 == "uring-muthu"){

233 
qu”y
<
ršg
::
uršg_muthu
<>,„šg::
ut
::
Œa™_di¡šù_uni
>(
šdex
, 
qu”›s
, 
lim™
);

234 }ià(
ty³
 == "c-uring-muthu"){

235 
qu”y
<
ršg
::
c_uršg_muthu
,„šg::
ut
::
Œa™_di¡šù_uni
>(
šdex
, 
qu”›s
, 
lim™
);

237 
¡d
::
cout
 << "Ty³ oàšdex: " << 
ty³
 << " i nÙ suµÜ‹d." << std::
’dl
;

240 
	}
}

	@query-index.cpp

20 
	~<io¡»am
>

21 
	~<ut™y
>

22 
	~"ršg.hµ
"

23 
	~<chrÚo
>

24 
	~<ŒË_·‰”n.hµ
>

25 
	~<Éj_®gÜ™hm.hµ
>

26 
	~<Éj_™”©Ü.hµ
>

27 
	~"uts.hµ
"

29 
	~<time.hµ
>

31 
usšg
 
Çme¥aû
 
	g¡d
;

36 
usšg
 
	gÇme¥aû
 ::
ut
::
time
;

38 
boŞ
 
g‘_fe_cÚ‹Á
(
¡ršg
 
f’ame
, 
veùÜ
<¡ršg> & 
veùÜ_of_¡ršgs
)

41 
if¡»am
 
š
(
f’ame
.
c_¡r
());

43 if(!
	gš
)

45 
	gû¼
 << "CªnÙ o³ÀthF: " << 
	gf’ame
 << 
	g’dl
;

46  
	gçl£
;

48 
¡ršg
 
	g¡r
;

50 
g‘lše
(
š
, 
¡r
))

53 if(
	g¡r
.
size
() > 0)

54 
	gveùÜ_of_¡ršgs
.
push_back
(
¡r
);

57 
	gš
.
şo£
();

58  
	gŒue
;

61 
	g¡d
::
¡ršg
 
	$Érim
(cÚ¡ 
¡d
::
¡ršg
 &
s
)

63 
size_t
 
¡¬t
 = 
s
.
	`fšd_fœ¡_nÙ_of
(' ');

64  (
¡¬t
 =ğ
¡d
::
¡ršg
::
Åos
è? "" : 
s
.
	`sub¡r
(start);

65 
	}
}

67 
	g¡d
::
¡ršg
 
	$¹rim
(cÚ¡ 
¡d
::
¡ršg
 &
s
)

69 
size_t
 
’d
 = 
s
.
	`fšd_Ï¡_nÙ_of
(' ');

70  (
’d
 =ğ
¡d
::
¡ršg
::
Åos
è? "" : 
s
.
	`sub¡r
(0,ƒnd + 1);

71 
	}
}

73 
	g¡d
::
¡ršg
 
	$Œim
(cÚ¡ 
¡d
::
¡ršg
 &
s
) {

74  
	`¹rim
(
	`Érim
(
s
));

75 
	}
}

77 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
	$tok’iz”
(cÚ¡ 
¡d
::
¡ršg
 &
šput
, cÚ¡ &
d–im™”
){

78 
¡d
::
¡ršg¡»am
 
	`¡»am
(
šput
);

79 
¡d
::
¡ršg
 
tok’
;

80 
¡d
::
veùÜ
<¡d::
¡ršg
> 
»s
;

81 
	`g‘lše
(
¡»am
, 
tok’
, 
d–im™”
)){

82 
»s
.
	`em¶aû_back
(
	`Œim
(
tok’
));

84  
»s
;

85 
	}
}

87 
boŞ
 
	$is_v¬ŸbË
(
¡ršg
 & 
s
)

89  (
s
.
	`©
(0) == '?');

90 
	}
}

92 
ušt8_t
 
g‘_v¬ŸbË
(
¡ršg
 &
s
, 
¡d
::
unÜd”ed_m­
<¡d::¡ršg, ušt8_t> &
hash_bË_v¬s
){

93 autØ
	gv¬
 = 
s
.
sub¡r
(1);

94 autØ
	g™
 = 
hash_bË_v¬s
.
fšd
(
v¬
);

95 if(
	g™
 =ğ
hash_bË_v¬s
.
’d
()){

96 
ušt8_t
 
id
 = 
hash_bË_v¬s
.
size
();

97 
	ghash_bË_v¬s
.
š£¹
({
v¬
, 
id
 });

98  
	gid
;

100  
	g™
->
	g£cÚd
;

104 
ušt64_t
 
	$g‘_cÚ¡ªt
(
¡ršg
 &
s
){

105  
¡d
::
	`¡ouÎ
(
s
);

106 
	}
}

108 
	gršg
::
ŒË_·‰”n
 
g‘_ŒË
(
¡ršg
 & 
s
, 
¡d
::
unÜd”ed_m­
<¡d::¡ršg, 
ušt8_t
> &
hash_bË_v¬s
) {

109 
	gveùÜ
<
	g¡ršg
> 
	g‹rms
 = 
tok’iz”
(
s
, ' ');

111 
	gršg
::
ŒË_·‰”n
 
ŒË
;

112 if(
is_v¬ŸbË
(
‹rms
[0])){

113 
	gŒË
.
v¬_s
(
g‘_v¬ŸbË
(
‹rms
[0], 
hash_bË_v¬s
));

115 
	gŒË
.
cÚ¡_s
(
g‘_cÚ¡ªt
(
‹rms
[0]));

117 if(
is_v¬ŸbË
(
‹rms
[1])){

118 
	gŒË
.
v¬_p
(
g‘_v¬ŸbË
(
‹rms
[1], 
hash_bË_v¬s
));

120 
	gŒË
.
cÚ¡_p
(
g‘_cÚ¡ªt
(
‹rms
[1]));

122 if(
is_v¬ŸbË
(
‹rms
[2])){

123 
	gŒË
.
v¬_o
(
g‘_v¬ŸbË
(
‹rms
[2], 
hash_bË_v¬s
));

125 
	gŒË
.
cÚ¡_o
(
g‘_cÚ¡ªt
(
‹rms
[2]));

127  
	gŒË
;

130 
	g¡d
::
¡ršg
 
	$g‘_ty³
(cÚ¡ 
¡d
::
¡ršg
 &
fe
){

131 autØ
p
 = 
fe
.
	`fšd_Ï¡_of
('.');

132  
fe
.
	`sub¡r
(
p
+1);

133 
	}
}

136 
	g‹m¶©e
<
şass
 
	gršg_ty³
, cÏs 
	gŒa™_ty³
>

137 
	$qu”y
(cÚ¡ 
¡d
::
¡ršg
 &
fe
, cÚ¡ std::¡ršg &
qu”›s
, cÚ¡ 
ušt64_t
 
lim™
){

138 
veùÜ
<
¡ršg
> 
dummy_qu”›s
;

139 
boŞ
 
»suÉ
 = 
	`g‘_fe_cÚ‹Á
(
qu”›s
, 
dummy_qu”›s
);

141 
ršg_ty³
 
g¿ph
;

143 
cout
 << " Lßdšghšdex..."; 
	`fæush
(
¡dout
);

144 
sd¦
::
	`lßd_äom_fe
(
g¿ph
, 
fe
);

146 
cout
 << 
’dl
 << " Index†ßded " << 
sd¦
::
	`size_š_by‹s
(
g¿ph
) << " bytes" <<ƒndl;

148 
¡d
::
if¡»am
 
ifs
;

149 
ušt64_t
 
nQ
 = 0;

151 ::
ut
::
time
::
u§ge
::
u§ge_ty³
 
¡¬t
, 
¡İ
;

152 
ušt64_t
 
tÙ®_–­£d_time
;

153 
ušt64_t
 
tÙ®_u£r_time
;

155 if(
»suÉ
)

158 
couÁ
 = 1;

159 
¡ršg
& 
qu”y_¡ršg
 : 
dummy_qu”›s
) {

163 
¡d
::
unÜd”ed_m­
<¡d::
¡ršg
, 
ušt8_t
> 
hash_bË_v¬s
;

164 
¡d
::
veùÜ
<
ršg
::
ŒË_·‰”n
> 
qu”y
;

165 
veùÜ
<
¡ršg
> 
tok’s_qu”y
 = 
	`tok’iz”
(
qu”y_¡ršg
, '.');

166 
¡ršg
& 
tok’
 : 
tok’s_qu”y
) {

167 autØ
ŒË_·‰”n
 = 
	`g‘_ŒË
(
tok’
, 
hash_bË_v¬s
);

168 
qu”y
.
	`push_back
(
ŒË_·‰”n
);

172 
ršg
::
	tÉj_™”©Ü
<
	tršg_ty³
, 
	tušt8_t
, 
	tušt64_t
> 
	t™”©Ü_ty³
;

173 #ià
ADAPTIVE


175 
ršg
::
	tÉj_®gÜ™hm
<
	t™”©Ü_ty³
,

176 
	tršg
::
	tveo
::
	tveo_ad­tive
<
	t™”©Ü_ty³
, 
	tŒa™_ty³
>> 
	t®gÜ™hm_ty³
;

179 #ià
VEO_RANDOM


180 
ršg
::
	tÉj_®gÜ™hm
<
	t™”©Ü_ty³
,

181 
	tršg
::
	tveo
::
	tveo_sim¶e_¿ndom
<
	t™”©Ü_ty³
, 
	tŒa™_ty³
>> 
	t®gÜ™hm_ty³
;

183 
ršg
::
	tÉj_®gÜ™hm
<
	t™”©Ü_ty³
,

184 
	tršg
::
	tveo
::
	tveo_sim¶e
<
	t™”©Ü_ty³
, 
	tŒa™_ty³
>> 
	t®gÜ™hm_ty³
;

187 
¡d
::
	tveùÜ
<
	tty³Çme
 
	t®gÜ™hm_ty³
::
	ttu¶e_ty³
> 
	t»suÉs_ty³
;

188 
»suÉs_ty³
 
»s
;

190 
¡¬t
 = ::
ut
::
time
::
u§ge
::
	`now
();

191 
®gÜ™hm_ty³
 
	`Éj
(&
qu”y
, &
g¿ph
);

192 
Éj
.
	`još_v2
(
»s
, 
lim™
, 600);

193 
¡İ
 = ::
ut
::
time
::
u§ge
::
	`now
();

195 
tÙ®_–­£d_time
 = (
ušt64_t
è
du¿tiÚ_ÿ¡
<
Çno£cÚds
>(
¡İ
.
–­£d
 - 
¡¬t
.elapsed);

196 
tÙ®_u£r_time
 = (
ušt64_t
è
du¿tiÚ_ÿ¡
<
Çno£cÚds
>(
¡İ
.
u£r
 - 
¡¬t
.user);

208 
cout
 << 
nQ
 << ";" << 
»s
.
	`size
(è<< ";" << 
tÙ®_–­£d_time
 << ";" << 
tÙ®_u£r_time
 << 
’dl
;

209 
nQ
++;

214 
couÁ
 += 1;

218 
	}
}

221 
	$maš
(
¬gc
, * 
¬gv
[])

224 
ršg
::
	tršg
<> 
	tršg_ty³
;

226 if(
¬gc
 != 4){

227 
¡d
::
cout
 << "U§ge: " << 
¬gv
[0] << " <šdex> <qu”›s> <lim™>" << std::
’dl
;

231 
¡d
::
¡ršg
 
šdex
 = 
¬gv
[1];

232 
¡d
::
¡ršg
 
qu”›s
 = 
¬gv
[2];

233 
ušt64_t
 
lim™
 = 
¡d
::
	`©Şl
(
¬gv
[3]);

234 
¡d
::
¡ršg
 
ty³
 = 
	`g‘_ty³
(
šdex
);

236 if(
ty³
 == "ring"){

237 
qu”y
<
ršg
::ršg<>,„šg::
ut
::
Œa™_size
>(
šdex
, 
qu”›s
, 
lim™
);

238 }ià(
ty³
 == "c-ring"){

239 
qu”y
<
ršg
::
c_ršg
,„šg::
ut
::
Œa™_size
>(
šdex
, 
qu”›s
, 
lim™
);

240 }ià(
ty³
 == "ring-sel"){

241 
qu”y
<
ršg
::
ršg_£l
,„šg::
ut
::
Œa™_size
>(
šdex
, 
qu”›s
, 
lim™
);

242 }ià(
ty³
 == "ring-muthu"){

244 }ià(
ty³
 == "c-ring-muthu"){

246 }ià(
ty³
 == "ring-sel-muthu"){

249 
¡d
::
cout
 << "Ty³ oàšdex: " << 
ty³
 << " i nÙ suµÜ‹d." << std::
’dl
;

255 
	}
}

	@
1
.
1
/usr/include
6
96
build-index-uring.cpp
build-index.cpp
check.cpp
proba.cpp
query-index-uring.cpp
query-index.cpp
